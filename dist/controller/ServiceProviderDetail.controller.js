sap.ui.define(["sap/ui/core/mvc/Controller","com/ServicesProviders/ServicesProviders/util/formatter","sap/m/MessageBox","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,r,o,i){"use strict";var s=o.EdmType;return e.extend("com.ServicesProviders.ServicesProviders.controller.ServiceProviderDetail",{formatter:t,onInit:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("ServiceProviderDetail").attachMatched(this._onRouteMatched,this)},handleClose:function(){var e=this.getOwnerComponent().getRouter();e.navTo("Home")},onServiceProviderPress:function(){var e=this.getOwnerComponent().getRouter();e.navTo("ServiceProvider")},onServicePress:function(){var e=this.getOwnerComponent().getRouter();e.navTo("Services")},_onRouteMatched:function(e){this.getView().byId("table1").getBinding("rows").refresh()},onSearch:function(){this.onGoPress()},onSearchService:function(){var e=this.getView().byId("searchservice").getValue();var t=this.getView();var r=[];if(e.length>0){var o=new sap.ui.model.Filter("tolower(SERVICE_NAME)",sap.ui.model.FilterOperator.Contains,"tolower('"+this.getView().byId("searchservice").getValue()+"')");r.push(o)}var i=t.byId("table1").getBinding("rows");if(e.length===0){i.filter([])}else{i.filter(r.length>0?new sap.ui.model.Filter(r,true):[])}},onGoPress:function(e){var t=this.getView();var r=t.byId("table1");var o=t.byId("searchprovider").getValue().toLowerCase();var i=t.byId("searchservice").getValue().toLowerCase();var s=t.byId("deleteditemsindetails").getSelectedKey();var n=t.byId("deleteditemsindetails").getSelectedItem();var a=n?n.getText():"";var l=[];if(o.length>0){var d=new sap.ui.model.Filter("tolower(SERVICEPROVIDER_NAME)",sap.ui.model.FilterOperator.Contains,"tolower('"+o+"')");l.push(d)}if(i.length>0){var g=new sap.ui.model.Filter("tolower(SERVICE_NAME)",sap.ui.model.FilterOperator.Contains,"tolower('"+i+"')");l.push(g)}if(a==="Deleted"){var E=new sap.ui.model.Filter("DELETIONFLAG",sap.ui.model.FilterOperator.Contains,s);l.push(E)}else if(a==="Non-Deleted"){var p=new sap.ui.model.Filter("DELETIONFLAG",sap.ui.model.FilterOperator.NE,"X");l.push(p)}var m=r.getBinding("rows");if(o.length===0&&i.length===0&&a===""){m.filter([])}else{m.filter(new sap.ui.model.Filter(l,true))}},createColumnConfig:function(){var e=[];e.push({label:"ID",property:["SERVICEPROVIDER_ID"],type:s.Number,template:"{0}, {1}"});e.push({label:"Provider Name",type:s.String,property:"SERVICEPROVIDER_NAME"});e.push({property:"SADARAVENDOR_ID",type:s.String});e.push({property:"PROVIDER_CATEGORY",type:s.String});e.push({property:"SERVICE_ID",type:s.String});e.push({property:"SERVICE_NAME",type:s.String});e.push({property:"SERVICE_DESCRIPTION",type:s.String});e.push({property:"SERVICECATEGORY_ID",type:s.String});e.push({property:"REMARKS",type:s.String});e.push({property:"SERVICEPROVIDER_CREATEDBY",type:s.String});e.push({property:"SERVICEPROVIDER_CREATIONDATETIME",type:s.Date});e.push({property:"SERVICEPROVIDER_UPDATEDATETIME",type:s.Date});e.push({property:"SERVICEPROVIDER_UPDATEDBY",type:s.String});e.push({property:"SERVICE_CREATEDBY",type:s.String});e.push({property:"SERVICE_CREATIONDATETIME",type:s.Date});e.push({property:"SERVICE_UPDATEDATETIME",type:s.Date});e.push({property:"SERVICE_UPDATEDBY",type:s.String});e.push({property:"DELETIONFLAG",type:s.String});return e},onExport:function(){var e,t,r,o,s;if(!this._oTable){this._oTable=this.byId("table1")}s=this._oTable;t=s.getBinding("rows");e=this.createColumnConfig();r={workbook:{count:5,columns:e,hierarchyLevel:"Level"},dataSource:t,type:"odata",fileName:"Service Provider Details.xlsx",worker:false};o=new i(r);o.build().finally(function(){o.destroy()})},AddProvider:function(){if(!this.AddProviderDetails){this.AddProviderDetails=new sap.ui.xmlfragment("com.ServicesProviders.ServicesProviders.fragments.AddProviderDetails",this);this.getView().addDependent(this.AddProviderDetails)}this.AddProviderDetails.open();this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].refreshItems;this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].refreshItems},onCancel:function(){this.AddProviderDetails.close();this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].setValue("");this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].setValue("");this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[2].getFields()[0].setValue("")},onCancelUpdateDetails:function(){this.UpdateProviderDetails.close()},changeStateUpdateDetails:function(e){var t=e.getSource();var r=t.getState();var o=r?"Are you sure you want to delete the provider?":"Are you sure you want to undo-delete the provider?";var i=r?"Confirm Deletion":"Confirm Undo-Deletion";sap.m.MessageBox.confirm(o,{title:i,actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){}else{t.setState(!r)}}})},onSave:function(){var e=this;const t=Date.now();const o=`/Date(${t})/`;const i=this.getOwnerComponent().getModel("SproviderModel");var s=i.sServiceUrl;var n=this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getSelectedKey();var a=this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getSelectedKey();var l=this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[2].getFields()[0].getValue();if(!n||!a){r.error("Provider or Service Not Selected")}else{var d=this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getSelectedItem().getText();var g=this.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getSelectedItem().getText();var E=`/CV_PROVIDER_DETAILS?$filter=startswith(tolower(SERVICEPROVIDER_NAME),tolower('${d}')) or startswith(tolower(SERVICE_NAME),tolower('${g}'))`;var p=false;$.ajax({url:s+E,method:"GET",dataType:"json",success:function(t){e.aResults=t.d.results;e.aResults.forEach(function(e){if(e.SERVICEPROVIDER_NAME.toLowerCase()===d.toLowerCase()&&e.SERVICE_NAME.toLowerCase()===g.toLowerCase()){p=true}});if(p){r.error("Service Provider or Service already Exists",{icon:r.Icon.ERROR,title:"Error",actions:[r.Action.OK]})}else{var i=e.getOwnerComponent().getModel("SproviderModel");var s={SERVICEPROVIDER_ID:n,SERVICE_ID:a,REMARKS:l,CREATIONDATETIME:o,CREATEDBY:sap.ushell.Container.getService("UserInfo").getFullName(),UPDATEDATETIME:null,UPDATEDBY:null,DELETIONFLAG:"",UUID:globalThis.crypto.randomUUID()};e.AddProviderDetails.close();i.create("/SERVICEPROVIDERDETAILS",s,{success:function(t){r.success("Details Created Successfully");e.getView().byId("table1").getBinding("rows").refresh();e.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].setValue("");e.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].setValue("");e.AddProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[2].getFields()[0].setValue("")},error:function(e){}})}},error:function(){}})}},onEditPress:function(){this.oSelectedItem=this.getView().byId("table1").getSelectedIndex();if(this.oSelectedItem<0){r.error("Please Select a Service Provider Detail to Proceed")}else{this.selectedItem=this.getView().byId("table1").getContextByIndex(this.oSelectedItem).getObject();if(!this.UpdateProviderDetails){this.UpdateProviderDetails=new sap.ui.xmlfragment("com.ServicesProviders.ServicesProviders.fragments.UpdateProviderDetails",this);this.getView().addDependent(this.UpdateProviderDetails)}this.UpdateProviderDetails.open();this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].refreshItems;this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].refreshItems;var e=true;if(this.selectedItem.DELETIONFLAG=="X"){e=true}else{e=false}var t=this.selectedItem.SERVICEPROVIDER_ID||"";this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getBinding("items").refresh();this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getBinding("items").refresh();this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].setSelectedKey(this.selectedItem.SERVICEPROVIDER_ID);this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].setSelectedKey(this.selectedItem.SERVICE_ID);this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[2].getFields()[0].setValue(this.selectedItem.REMARKS);this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[3].getFields()[0].setState(e)}},onUpdate:function(){var e=this;const t=Date.now();const o=`/Date(${t})/`;const i=this.getOwnerComponent().getModel("SproviderModel");var s=i.sServiceUrl;var n=this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getSelectedKey();var a=this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getSelectedKey();var l=this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[2].getFields()[0].getValue();if(!n||!a){r.error("Provider or Service Not Selected")}else{var d=this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getSelectedItem().getText();var g=this.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getSelectedItem().getText();var E=`/CV_PROVIDER_DETAILS?$filter=startswith(tolower(SERVICEPROVIDER_NAME ),tolower('${d}')) or startswith(tolower(SERVICE_NAME),tolower('${g}'))`;var p=false;$.ajax({url:s+E,method:"GET",dataType:"json",success:function(t){e.aResults=t.d.results;e.aResults.forEach(function(t){if(t.UUID===e.selectedItem.UUID){return}if(t.SERVICEPROVIDER_NAME.toLowerCase()===d.toLowerCase()&&t.SERVICE_NAME.toLowerCase()===g.toLowerCase()){p=true}});if(p){r.error("Service or Category ID already Exists",{icon:r.Icon.ERROR,title:"Information",actions:[r.Action.OK]})}else{var i=e.getOwnerComponent().getModel("SproviderModel");var s={SERVICEPROVIDER_ID:n,SERVICE_ID:a,REMARKS:l,CREATIONDATETIME:null,CREATEDBY:null,UPDATEDATETIME:o,UPDATEDBY:sap.ushell.Container.getService("UserInfo").getFullName(),DELETIONFLAG:e.UpdateProviderDetails.getContent()[0].getFormContainers()[0].getFormElements()[3].getFields()[0].getState()?"X":"",UUID:e.selectedItem.UUID};e.UpdateProviderDetails.close();i.update("/SERVICEPROVIDERDETAILS('"+e.selectedItem.UUID+"')",s,{success:function(t){r.success("Details Updated Successfully");e.getView().byId("table1").getBinding("rows").refresh()},error:function(e){}})}},error:function(){}})}}})});