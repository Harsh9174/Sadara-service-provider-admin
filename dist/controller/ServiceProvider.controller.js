sap.ui.define(["sap/ui/core/mvc/Controller","com/ServicesProviders/ServicesProviders/util/formatter","sap/m/MessageBox","sap/ui/export/library","sap/ui/export/Spreadsheet"],function(e,t,r,o,i){"use strict";var s=o.EdmType;return e.extend("com.ServicesProviders.ServicesProviders.controller.ServiceProvider",{formatter:t,onInit:function(){this.localModel=new sap.ui.model.json.JSONModel;this.getView().setModel(this.localModel,"localModel");var e=sap.ui.core.UIComponent.getRouterFor(this);e.getRoute("ServiceProvider").attachMatched(this._onRouteMatched,this)},handleClose:function(){var e=this.getOwnerComponent().getRouter();e.navTo("Home")},onServicePress:function(){var e=this.getOwnerComponent().getRouter();e.navTo("Services")},onServiceProviderDetailPress:function(){var e=this.getOwnerComponent().getRouter();e.navTo("ServiceProviderDetail")},onSearch:function(){this.onGoPress()},_onRouteMatched:function(e){this.getView().byId("productsTable").getBinding("rows").refresh()},onGoPress:function(e){var t=this.getView().byId("productsTable");var r=this.getView();var o=r.byId("articleMultiInput1").getValue();var i=r.byId("mydeleteditems").getSelectedKey();var s=r.byId("mydeleteditems").getSelectedItem();var n="";if(s){n=s.getText()||""}var a=[];if(o.length>0){var d=new sap.ui.model.Filter("tolower(SERVICEPROVIDER_NAME)",sap.ui.model.FilterOperator.Contains,"tolower('"+this.getView().byId("articleMultiInput1").getValue()+"')");a.push(d)}if(n=="Deleted"){var l=new sap.ui.model.Filter("DELETIONFLAG",sap.ui.model.FilterOperator.Contains,i);a.push(l)}else if(n=="Non-Deleted"){var c=new sap.ui.model.Filter("DELETIONFLAG",sap.ui.model.FilterOperator.NE,"X");a.push(c)}var E=r.byId("productsTable").getBinding("rows");if(o.length===0&&n===""){E.filter([])}else{E.filter(a.length>0?new sap.ui.model.Filter(a,true):[])}},createColumnConfig:function(){var e=[];e.push({label:"ID",property:["SERVICEPROVIDER_ID"],type:s.Number,template:"{0}, {1}"});e.push({label:"Provider Name",type:s.String,property:"SERVICEPROVIDER_NAME"});e.push({property:"SADARAVENDOR_ID",type:s.String});e.push({property:"CREATIONDATETIME",type:s.Date});e.push({property:"CREATEDBY",type:s.String});e.push({property:"UPDATEDATETIME",type:s.Date});e.push({property:"UPDATEDBY",type:s.String});e.push({property:"DELETIONFLAG",type:s.String});return e},onExport:function(){var e,t,r,o,s;if(!this._oTable){this._oTable=this.byId("productsTable")}s=this._oTable;t=s.getBinding("rows");e=this.createColumnConfig();r={workbook:{count:5,columns:e,hierarchyLevel:"Level"},dataSource:t,type:"odata",fileName:"Provider Master.xlsx",worker:false};o=new i(r);o.build().finally(function(){o.destroy()})},onEditPress:function(){this.oSelectedItem=this.getView().byId("productsTable").getSelectedIndex();if(this.oSelectedItem<0){r.error("Please Select a Service Provider to Proceed")}else{this.selectedItem=this.getView().byId("productsTable").getContextByIndex(this.oSelectedItem).getObject();if(!this.UpdateProvider){this.UpdateProvider=new sap.ui.xmlfragment("com.ServicesProviders.ServicesProviders.fragments.UpdateProvider",this);this.getView().addDependent(this.UpdateProvider)}var e=true;if(this.selectedItem.DELETIONFLAG=="X"){e=true}else{e=false}this.UpdateProvider.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].setValue(this.selectedItem.SERVICEPROVIDER_NAME);this.UpdateProvider.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].setValue(this.selectedItem.SADARAVENDOR_ID);this.UpdateProvider.getContent()[0].getFormContainers()[0].getFormElements()[2].getFields()[0].setState(e);this.UpdateProvider.open()}},onCancel:function(){this.UpdateProvider.close()},changeDeleteStateUpdateProvider:function(e){var t=e.getSource();var r=t.getState();var o=r?"Are you sure you want to delete the provider?":"Are you sure you want to undo-delete the provider?";var i=r?"Confirm Deletion":"Confirm Undo-Deletion";sap.m.MessageBox.confirm(o,{title:i,actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],onClose:function(e){if(e===sap.m.MessageBox.Action.YES){if(r){console.log("Provider deleted.")}else{console.log("Undo-delete operation performed.")}}else{t.setState(!r)}}})},AddProvider:function(){if(!this.AddNewProvider){this.AddNewProvider=new sap.ui.xmlfragment("com.ServicesProviders.ServicesProviders.fragments.AddNewProvider",this);this.getView().addDependent(this.AddNewProvider)}this.AddNewProvider.open()},onCancelNewProvider:function(){this.AddNewProvider.close();this.AddNewProvider.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].setValue();this.AddNewProvider.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].setValue()},onSave:function(){var e=this;const t=e.getOwnerComponent().getModel("SproviderModel");const o=Date.now();const i=`/Date(${o})/`;var s=this.AddNewProvider.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getValue();var n=this.AddNewProvider.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getValue();var a=t.sServiceUrl;var d="/SERVICEPROVIDERMASTER?$filter=startswith(tolower(SERVICEPROVIDER_NAME),tolower('"+s+"')) or startswith(tolower(SADARAVENDOR_ID),tolower('"+n+"'))";$.ajax({url:a+d,method:"GET",dataType:"json",success:function(o){e.aResults=o.d.results;var a=false;e.aResults.forEach(function(e){if(e.SERVICEPROVIDER_NAME.toLowerCase()===s.toLowerCase()||e.SADARAVENDOR_ID.toLowerCase()===n.toLowerCase()){a=true}});if(!s||!n){r.error("Provider or Vendor ID Cannot be empty",{icon:sap.m.MessageBox.Icon.ERROR,title:"Information",actions:[r.Action.OK]})}else if(a){r.error("Provider or Vendor ID already exists",{icon:sap.m.MessageBox.Icon.ERROR,title:"Information",actions:[r.Action.OK]})}else{var d="/ServiceProviderOdata/SDR/ServiceProviders/Application/ServiceProviders_seq.xsjs";$.ajax({url:d,method:"GET",dataType:"json",success:function(o){e.highestID=parseInt(o[0].VALUE);var s={SERVICEPROVIDER_ID:e.highestID,SERVICEPROVIDER_NAME:e.AddNewProvider.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getValue(),SADARAVENDOR_ID:e.AddNewProvider.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getValue(),CREATIONDATETIME:i,CREATEDBY:sap.ushell.Container.getService("UserInfo").getFullName(),UPDATEDATETIME:null,UPDATEDBY:null,DELETIONFLAG:""};e.AddNewProvider.close();t.create("/SERVICEPROVIDERMASTER",s,{success:function(t){r.success("Provider Created Successfully",{onClose:function(){e.AddNewProvider.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].setValue();e.AddNewProvider.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].setValue();e.getView().byId("productsTable").getBinding("rows").refresh()}})},error:function(e){console.error("Error creating provider:",e);r.error("An error occurred while creating the provider.")}})},error:function(){}})}},error:function(e){console.error("Error fetching data:",e);r.error("An error occurred while checking for provider existence.")}})},onUpdate:function(){var e=this;var t=this.selectedItem.SERVICEPROVIDER_ID;const o=Date.now();const i=`/Date(${o})/`;const s=this.getOwnerComponent().getModel("SproviderModel");var n=s.sServiceUrl;var a=this.UpdateProvider.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getValue();var d=this.UpdateProvider.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getValue();var l=`/SERVICEPROVIDERMASTER?$filter=startswith(tolower(SERVICEPROVIDER_NAME),tolower('${a}')) or startswith(tolower(SADARAVENDOR_ID),tolower('${d}'))`;var c=false;if(!a||!d){r.information("Provider or Vendor ID Cannot be Empty")}else{$.ajax({url:n+l,method:"GET",dataType:"json",success:function(o){e.aResults=o.d.results;e.aResults.forEach(function(e){if(e.SERVICEPROVIDER_ID===t){return}if(e.SERVICEPROVIDER_NAME.toLowerCase()===a.toLowerCase()||e.SADARAVENDOR_ID.toLowerCase()===d.toLowerCase()){c=true}});if(c){r.error("Provider or Vendor ID already Exists",{icon:r.Icon.ERROR,title:"Information",actions:[r.Action.OK]})}else{var n={SERVICEPROVIDER_ID:e.selectedItem.SERVICEPROVIDER_ID,SERVICEPROVIDER_NAME:e.UpdateProvider.getContent()[0].getFormContainers()[0].getFormElements()[0].getFields()[0].getValue(),SADARAVENDOR_ID:e.UpdateProvider.getContent()[0].getFormContainers()[0].getFormElements()[1].getFields()[0].getValue(),CREATIONDATETIME:e.selectedItem.CREATIONDATETIME,CREATEDBY:e.selectedItem.CREATEDBY,UPDATEDATETIME:i,UPDATEDBY:sap.ushell.Container.getService("UserInfo").getFullName(),DELETIONFLAG:e.UpdateProvider.getContent()[0].getFormContainers()[0].getFormElements()[2].getFields()[0].getState()?"X":""};e.UpdateProvider.close();s.update("/SERVICEPROVIDERMASTER("+e.selectedItem.SERVICEPROVIDER_ID+")",n,{success:function(e,t){r.success("Provider Updated Successfully")},error:function(e){}})}},error:function(){}})}}})});